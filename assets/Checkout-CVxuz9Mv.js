import{u as C,o as A,r as u,A as D,c as O,j as e,m as i,B as h,D as E,E as k,G as F,z as x,t as $}from"./index-BwQBjtFe.js";import{S as b}from"./Skeleton-COt5SVUs.js";import{g as z,s as B}from"./orders-DwCKsmjF.js";const I={details:"",phone:"",city:""};function _(){const p=C(),g=A(),[o,f]=u.useState(I),[y,j]=u.useState("cash"),[c,l]=u.useState({}),{data:N}=D(),n=N?.data?.products??[],m=n.reduce((r,a)=>{const s=a.product?.priceAfterDiscount??a.price;return r+s*a.count},0),w=n.length===0,d=(r,a)=>{const s=a.trim();if(!s)return l(t=>({...t,[r]:`${r} is required`})),!1;if(r==="phone"){const t=s.replace(/\s+/g,"");if(!/^\d{10,}$/.test(t))return l(S=>({...S,phone:"Phone must be at least 10 digits (numbers only)"})),!1}return l(t=>({...t,[r]:""})),!0},v=O({mutationFn:()=>{const r={_id:z(),shippingAddress:o,cartItems:n.map(a=>({product:a.product?.id??a.product?._id??"",count:a.count,price:a.product?.priceAfterDiscount??a.price})),totalOrderPrice:m,createdAt:new Date().toISOString(),isPaid:!1,isDelivered:!1};return B(r),$.clear()},onSuccess:()=>{g.invalidateQueries({queryKey:["cart"]}),x.success("Order placed successfully!"),p("/orders")},onError:()=>x.error("Failed to complete order")}),P=r=>{r.preventDefault();let a=!0;for(const s of["details","city","phone"])d(s,o[s])||(a=!1);if(!a){x.error("Please fix the errors above");return}return v.mutate(),e.jsxs("div",{className:"mx-auto max-w-2xl px-4 py-8",children:[e.jsx(b,{className:"h-10 w-48 mb-8"}),e.jsx(b,{className:"h-64 rounded-[var(--radius-2xl)]"})]})};return w?e.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mx-auto max-w-2xl px-4 py-16 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-[var(--color-foreground)] mb-4",children:"Your cart is empty"}),e.jsx(h,{variant:"primary",onClick:()=>p("/products"),children:"Browse products"})]}):e.jsxs(i.div,{initial:{opacity:0},animate:{opacity:1},className:"mx-auto max-w-2xl px-4 py-8 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-[var(--color-foreground)] mb-8",children:"Checkout"}),e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{className:"rounded-[var(--radius-2xl)] border border-[var(--color-border)] bg-[var(--color-card)] p-6 shadow-[var(--shadow-soft)] space-y-4",children:[e.jsx("h2",{className:"font-semibold text-[var(--color-foreground)]",children:"Shipping address"}),["details","city","phone"].map(r=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--color-muted-foreground)] mb-1 capitalize",children:r==="details"?"Address":r}),e.jsx("input",{type:r==="phone"?"tel":"text",value:o[r],onChange:a=>{f(s=>({...s,[r]:a.target.value})),d(r,a.target.value)},onBlur:a=>d(r,a.target.value),className:`w-full h-11 px-4 rounded-[var(--radius-xl)]
                           border transition
                           bg-[var(--color-card)]
                           text-[var(--color-foreground)]
                           focus:ring-2 focus:outline-none
                           ${c[r]?"border-error focus:ring-error/20":"border-[var(--color-border)] focus:ring-[var(--color-primary)] focus:border-transparent"}`,placeholder:r==="phone"?"01234567890":r==="details"?"Street, building, apartment":"Cairo"}),c[r]&&e.jsx("p",{className:"text-xs text-error mt-1",children:c[r]})]},r))]}),e.jsxs("div",{className:"rounded-[var(--radius-2xl)] border border-[var(--color-border)] bg-[var(--color-card)] p-6 shadow-[var(--shadow-soft)] space-y-4",children:[e.jsx("h2",{className:"font-semibold text-[var(--color-foreground)]",children:"Payment method"}),e.jsx("div",{className:"grid sm:grid-cols-2 gap-4",children:[{id:"cash",label:"Cash on delivery",icon:E},{id:"visa",label:"Visa / Card payment",icon:k}].map(r=>{const a=r.icon,s=y===r.id;return e.jsxs(i.button,{type:"button",whileTap:{scale:.97},onClick:()=>j(r.id),className:`
            relative flex items-center gap-4 p-4 rounded-2xl border text-left
            transition-all duration-200
            ${s?"border-[var(--color-primary)] ring-2 ring-[var(--color-primary)]/30 bg-[var(--color-card-hover)]":"border-[var(--color-border)] hover:bg-[var(--color-card-hover)]"}
          `,children:[e.jsx("div",{className:`
              h-11 w-11 rounded-xl flex items-center justify-center
              ${s?"bg-[var(--color-primary)] text-white":"bg-[var(--color-card-hover)] text-[var(--color-muted-foreground)]"}
            `,children:e.jsx(a,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-[var(--color-foreground)]",children:r.label}),e.jsx("p",{className:"text-xs text-[var(--color-muted-foreground)]",children:r.id==="visa"?"Secure online payment":"Pay when the order arrives"})]}),e.jsx(F,{children:s&&e.jsx(i.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},className:"absolute top-2 right-2 h-3 w-3 rounded-full bg-[var(--color-primary)]"})})]},r.id)})})]}),e.jsxs("div",{className:"rounded-[var(--radius-2xl)] border border-[var(--color-border)] bg-[var(--color-card)] p-6 shadow-[var(--shadow-soft)] space-y-4",children:[e.jsx("div",{className:"space-y-2 text-sm",children:n.map(r=>{const a=r.product?.priceAfterDiscount??r.price;return e.jsxs("div",{className:"flex justify-between text-[var(--color-muted-foreground)]",children:[e.jsxs("span",{children:[r.product?.title," Ã— ",r.count]}),e.jsxs("span",{className:"text-[var(--color-foreground)] font-medium",children:["EGP ",a*r.count]})]},r._id)})}),e.jsx("div",{className:"h-px bg-[var(--color-border)]"}),e.jsxs("div",{className:"flex justify-between text-lg font-semibold text-[var(--color-foreground)]",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["EGP ",m]})]}),e.jsx(h,{type:"submit",variant:"primary",size:"lg",className:"w-full",loading:v.isPending,disabled:Object.values(c).some(r=>r)||Object.values(o).some(r=>!r.trim()),children:"Place order"})]})]})]})}export{_ as Checkout};
