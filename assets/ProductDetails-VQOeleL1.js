import{n as z,r as I,o as B,e as R,c as P,j as r,L as K,m as L,p as h,B as M,q as W,s as G,z as c,t as v,w as A}from"./index-BOkdaHzX.js";import{u as _,p as H}from"./useWishlistIds-Dd4xBM_l.js";import{S as i}from"./Skeleton-YTw2gt5K.js";function U(){const{id:t}=z(),[g,b]=I.useState(1),[f,S]=I.useState(0),l=B(),F=_(),n=t?F.includes(t):!1,{data:j,isLoading:q,error:D}=R({queryKey:["product",t],queryFn:()=>H.getById(t).then(s=>s.data.data),enabled:!!t}),y=P({mutationFn:async s=>{const a=o=>{const d=o?.product,x=d?.id;if(typeof x=="string"&&x)return x;const p=d?._id;return typeof p=="string"&&p?p:""},N=l.getQueryData(["cart"]);if(N?.data?.products){const o=N.data.products.find(d=>a(d)===t);if(o){const d=a(o)||t;return v.updateCount(d,o.count+s)}}const k=await v.add(t,s),u=k.data?.data?.products?.find(o=>a(o)===t),C=u?.count;if(s>1&&(typeof C!="number"||C<s)){const o=u?a(u):"";return v.updateCount(o||t,s)}return k},onSuccess:()=>{l.invalidateQueries({queryKey:["cart"]}),c.success("Added to cart")},onError:()=>c.error("Failed to add to cart")}),w=P({mutationFn:()=>n?A.remove(t):A.add(t),onSuccess:()=>{l.invalidateQueries({queryKey:["wishlist"]}),c.success(n?"Removed from wishlist":"Added to wishlist")},onError:()=>c.error("Something went wrong")});if(D||!t)return r.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-16 text-center",children:[r.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Product not found."}),r.jsx(K,{to:"/products",className:"mt-4 inline-block text-indigo-600 dark:text-indigo-400 hover:underline",children:"Back to products"})]});if(q||!j)return r.jsx("div",{className:"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"grid gap-8 lg:grid-cols-2",children:[r.jsx(i,{className:"aspect-square rounded-3xl"}),r.jsxs("div",{className:"space-y-4",children:[r.jsx(i,{className:"h-10 w-3/4"}),r.jsx(i,{className:"h-6 w-1/2"}),r.jsx(i,{className:"h-32 w-full"})]})]})});const e=j,m=e.images?.length?e.images:[e.imageCover],E=e.priceAfterDiscount??e.price,Q=e.priceAfterDiscount!=null;return r.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},className:"mx-auto max-w-7xl px-4 py-6 sm:py-8 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"grid gap-6 sm:gap-8 lg:grid-cols-2",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"aspect-square overflow-hidden rounded-3xl border border-[var(--color-border)] dark:border-[var(--color-border)] bg-[var(--color-card)] dark:bg-[var(--color-card)]",children:r.jsx("img",{src:m[f]??e.imageCover,alt:e.title,decoding:"async",className:"h-full w-full object-cover"})}),m.length>1&&r.jsx("div",{className:"-mx-4 flex gap-2 overflow-x-auto px-4 pb-2 touch-pan-x snap-x snap-mandatory sm:mx-0 sm:px-0",children:m.map((s,a)=>r.jsx("button",{type:"button",onClick:()=>S(a),className:h("h-20 w-20 shrink-0 snap-start rounded-xl border-2 overflow-hidden transition-all",f===a?"border-[var(--color-primary)] ring-2 ring-[var(--color-primary)]/30":"border-[var(--color-border)] dark:border-[var(--color-border)] hover:border-[var(--color-muted)] dark:hover:border-[var(--color-muted-foreground)]"),children:r.jsx("img",{src:s,alt:"",loading:"lazy",decoding:"async",className:"h-full w-full object-cover"})},a))})]}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold leading-tight text-[var(--color-foreground)]",children:e.title}),r.jsxs("p",{className:"mt-2 text-[var(--color-muted)] dark:text-[var(--color-muted-foreground)]",children:[e.category?.name," · ",e.brand?.name]}),r.jsxs("div",{className:"mt-6 flex flex-wrap items-end gap-3",children:[r.jsxs("span",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-primary)] dark:text-[var(--color-primary)]",children:["EGP ",E]}),Q&&r.jsxs("span",{className:"text-base sm:text-xl text-[var(--color-muted)] line-through",children:["EGP ",e.price]})]}),r.jsx("p",{className:"mt-6 text-[var(--color-muted)] dark:text-[var(--color-muted-foreground)] leading-relaxed",children:e.description}),r.jsxs("div",{className:"mt-8 flex flex-col gap-4 sm:flex-row sm:flex-wrap sm:items-center sm:gap-4",children:[r.jsxs("div",{className:"order-1 sm:order-none flex items-center rounded-2xl border border-[var(--color-border)] dark:border-[var(--color-border)] overflow-hidden",children:[r.jsx("button",{type:"button",onClick:()=>b(s=>Math.max(1,s-1)),className:"h-12 w-12 flex items-center justify-center hover:bg-[var(--color-card-hover)] dark:hover:bg-[var(--color-card-hover)] transition-colors",children:"−"}),r.jsx("span",{className:"h-12 w-14 flex items-center justify-center font-medium border-x border-[var(--color-border)] dark:border-[var(--color-border)]",children:g}),r.jsx("button",{type:"button",onClick:()=>b(s=>Math.min(e.quantity,s+1)),className:"h-12 w-12 flex items-center justify-center hover:bg-[var(--color-card-hover)] dark:hover:bg-[var(--color-card-hover)] transition-colors",children:"+"})]}),r.jsxs(M,{variant:"primary",size:"lg",loading:y.isPending,onClick:()=>y.mutate(g),className:"order-3 sm:order-none sm:w-auto inline-flex items-center justify-center gap-2",children:[r.jsx(W,{className:"h-5 w-5"}),"Add to cart"]}),r.jsx("button",{type:"button",onClick:()=>w.mutate(),disabled:w.isPending,className:h("order-2 sm:order-none self-end sm:self-auto p-3 rounded-2xl border border-[var(--color-border)] dark:border-[var(--color-border)] hover:bg-[var(--color-card-hover)] dark:hover:bg-[var(--color-card-hover)] transition-colors",n&&"text-red-500 border-red-200 dark:border-red-900"),"aria-label":n?"Remove from wishlist":"Add to wishlist",children:r.jsx(G,{className:h("h-5 w-5",n&&"fill-current")})})]})]})]})})}export{U as ProductDetails};
