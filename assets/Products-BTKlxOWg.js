import{Q as S,i as k,h as A,f as L,g as B,k as _,l as q,r as g,j as n,m as z}from"./index-DqMWGEfX.js";import{u as W,p as D}from"./useWishlistIds-C2W9zeNn.js";import{P as G}from"./ProductCard-B_dfns1c.js";import{P as K}from"./Skeleton-xxPTFTLQ.js";var T=class extends S{constructor(e,r){super(e,r)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:k()})}getOptimisticResult(e){return e.behavior=k(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,r){const{state:o}=e,i=super.createResult(e,r),{isFetching:f,isRefetching:h,isError:d,isRefetchError:P}=i,u=o.fetchMeta?.fetchMore?.direction,l=d&&u==="forward",x=f&&u==="forward",m=d&&u==="backward",p=f&&u==="backward";return{...i,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:L(r,o.data),hasPreviousPage:A(r,o.data),isFetchNextPageError:l,isFetchingNextPage:x,isFetchPreviousPageError:m,isFetchingPreviousPage:p,isRefetchError:P&&!l&&!m,isRefetching:h&&!x&&!p}}};function Z(e,r){return B(e,T)}const E=12;function F(e){return e?.id??e?._id??""}function O(e){const r=e?.data;return Array.isArray(r)?r:[]}function H(e){return{...e,id:e.id??e._id??""}}function J(e){const r=new Set;return e.filter(o=>{const i=o.id??o._id??"";return!i||r.has(i)?!1:(r.add(i),!0)})}function ee(){const[e]=_(),r=e.get("category")??"",o=e.get("brand")??"",i=q()?.searchQuery??e.get("q")??"",f=g.useRef(null),h=g.useRef(!1),{data:d,fetchNextPage:P,hasNextPage:u,isFetchingNextPage:l,isLoading:x,isFetching:m}=Z({queryKey:["products","infinite",{category:r,brand:o}],queryFn:({pageParam:t})=>D.getAll({page:t,limit:E,category:r||void 0,brand:o||void 0}).then(s=>s.data),initialPageParam:1,getNextPageParam:(t,s)=>{const c=O(t);if(c.length===0)return;const a=t?.metadata,b=s.slice(0,-1).flatMap(O),Q=new Set(b.map(F).filter(Boolean));if(!c.some(v=>{const M=F(v);return!!M&&!Q.has(M)}))return;if(typeof a?.nextPage=="number")return a.nextPage;if(typeof a?.nextPage=="string"){const v=Number(a.nextPage);if(Number.isFinite(v))return v}if(typeof a?.currentPage=="number"&&typeof a?.numberOfPages=="number")return a.currentPage<a.numberOfPages?a.currentPage+1:void 0;const N=t?.page,R=t?.totalPages;if(typeof N=="number"&&typeof R=="number")return N<R?N+1:void 0;if(!(c.length<E))return s.length+1}}),p=W({enabled:!!d}),w=g.useMemo(()=>new Set(p),[p]),I=g.useCallback(()=>{!u||l||h.current||(h.current=!0,P().finally(()=>{h.current=!1}))},[u,l,P]);g.useEffect(()=>{const t=f.current;if(!t)return;const s=new IntersectionObserver(c=>{c[0]?.isIntersecting&&I()},{rootMargin:"100px"});return s.observe(t),()=>s.disconnect()},[I]);const y=g.useMemo(()=>{const t=d?.pages.flatMap(a=>(a.data??[]).map(H))??[],s=J(t);if(!i.trim())return s;const c=i.trim().toLowerCase();return s.filter(a=>{const j=a.title.toLowerCase(),b=a.description.toLowerCase();return j.includes(c)||b.includes(c)})},[d,i]),C=x||m&&y.length===0;return n.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8",children:[n.jsx(z.h1,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-3xl font-bold text-[var(--color-foreground)] dark:text-[var(--color-foreground)] mb-8",children:"All products"}),C?n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:Array.from({length:8}).map((t,s)=>n.jsx(K,{},s))}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:y.map((t,s)=>n.jsx(G,{product:t,isInWishlist:w.has(t.id),imageLoading:s<8?"eager":"lazy"},t.id))}),n.jsx("div",{ref:f,className:"h-10 flex items-center justify-center py-8",children:l&&n.jsxs("div",{className:"flex gap-2",children:[n.jsx("div",{className:"h-2 w-2 rounded-full bg-[var(--color-primary)] animate-bounce [animation-delay:-0.3s]"}),n.jsx("div",{className:"h-2 w-2 rounded-full bg-[var(--color-primary)] animate-bounce [animation-delay:-0.15s]"}),n.jsx("div",{className:"h-2 w-2 rounded-full bg-[var(--color-primary)] animate-bounce"})]})}),y.length===0&&!m&&n.jsx("p",{className:"text-center text-[var(--color-muted)] dark:text-[var(--color-muted-foreground)] py-16",children:"No products found. Try changing filters or search."})]})]})}export{ee as Products};
