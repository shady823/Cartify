import{o as w,x as C,c as f,j as e,m as p,L as m,B as b,y as k,z as h,t as j}from"./index-CsaSfNwg.js";import{S as u}from"./Skeleton-DqiHYImT.js";function _(){const c=w(),{data:g,isLoading:v}=C(),l=f({mutationFn:({productId:t,count:s})=>j.updateCount(t,s),onMutate:async({productId:t,count:s})=>{await c.cancelQueries({queryKey:["cart"]});const r=c.getQueryData(["cart"]);if(r?.data?.products){const n=r.data.products.map(a=>(a.product?.id??a.product?._id??"")===t?{...a,count:s}:a),i=n.reduce((a,d)=>a+d.count,0),o=n.reduce((a,d)=>a+(d.product?.priceAfterDiscount??d.price)*d.count,0);c.setQueryData(["cart"],{...r,numOfCartItems:i,data:{...r.data,products:n,totalCartPrice:o}})}return{prev:r}},onError:(t,s,r)=>{r?.prev&&c.setQueryData(["cart"],r.prev),h.error("Failed to update")},onSuccess:()=>c.invalidateQueries({queryKey:["cart"]})}),y=f({mutationFn:t=>j.remove(t),onMutate:async t=>{await c.cancelQueries({queryKey:["cart"]});const s=c.getQueryData(["cart"]);if(s?.data?.products){const r=s.data.products.filter(o=>(o.product?.id??o.product?._id??"")!==t),n=r.reduce((o,a)=>o+a.count,0),i=r.reduce((o,a)=>o+(a.product?.priceAfterDiscount??a.price)*a.count,0);c.setQueryData(["cart"],{...s,numOfCartItems:n,data:{...s.data,products:r,totalCartPrice:i}})}return{prev:s}},onError:(t,s,r)=>{r?.prev&&c.setQueryData(["cart"],r.prev),h.error("Failed to remove")},onSuccess:()=>h.success("Removed from cart"),onSettled:()=>c.invalidateQueries({queryKey:["cart"]})}),x=g?.data?.products??[],N=x.reduce((t,s)=>t+(s.product?.priceAfterDiscount??s.price)*s.count,0);return v?e.jsxs("div",{className:"mx-auto max-w-4xl px-4 py-8 sm:px-6 lg:px-8",children:[e.jsx(u,{className:"h-10 w-48 mb-8"}),e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex gap-4 rounded-2xl border-border bg-card p-4",children:[e.jsx(u,{className:"h-24 w-24 rounded-xl"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(u,{className:"h-5 w-3/4"}),e.jsx(u,{className:"h-4 w-1/2"})]})]},t))})]}):x.length===0?e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mx-auto max-w-4xl px-4 py-16 sm:px-6 lg:px-8 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-on-background mb-4",children:"Your cart is empty"}),e.jsx("p",{className:"text-muted mb-8",children:"Add some products to get started."}),e.jsx(m,{to:"/products",children:e.jsx(b,{variant:"primary",size:"lg",children:"Browse products"})})]}):e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},className:"mx-auto max-w-4xl px-4 py-8 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-on-background mb-8",children:"Cart"}),e.jsx("div",{className:"space-y-4",children:x.map(t=>{const s=t.id??t._id??"",r=t.product?.id??t.product?._id??"",n=t.product?.priceAfterDiscount??t.price,i=t.product?.price??t.price,o=n!==i;return e.jsxs(p.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"flex flex-col sm:flex-row gap-4 rounded-2xl border-border bg-card p-4 shadow-soft",children:[e.jsxs(m,{to:`/products/${r}`,className:"flex gap-4 sm:flex-1 min-w-0",children:[e.jsx("img",{src:t.product.imageCover,alt:t.product.title,loading:"lazy",decoding:"async",className:"h-24 w-24 shrink-0 rounded-xl object-cover"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"font-semibold text-on-background truncate",children:t.product.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsxs("p",{className:"text-primary",children:["EGP ",n," each"]}),o&&e.jsxs("p",{className:"text-muted text-sm line-through",children:["EGP ",i]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 sm:gap-6",children:[e.jsxs("div",{className:"flex items-center rounded-xl border-border overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>l.mutate({productId:r,count:Math.max(1,t.count-1)}),disabled:l.isPending||t.count<=1||!r,className:"h-10 w-10 flex items-center justify-center hover:bg-hover transition-colors disabled:opacity-50",children:"âˆ’"}),e.jsx("span",{className:"h-10 w-12 flex items-center justify-center font-medium border-x border-border text-sm",children:t.count}),e.jsx("button",{type:"button",onClick:()=>l.mutate({productId:r,count:t.count+1}),disabled:l.isPending||!r,className:"h-10 w-10 flex items-center justify-center hover:bg-hover transition-colors",children:"+"})]}),e.jsxs("p",{className:"font-semibold text-on-background w-20 text-right",children:["EGP ",n*t.count]}),e.jsx("button",{type:"button",onClick:()=>y.mutate(r),disabled:y.isPending||!r,className:"p-2 rounded-xl text-error hover:bg-error/10 transition-colors","aria-label":"Remove item",children:e.jsx(k,{className:"h-5 w-5"})})]})]},s||r)})}),e.jsxs("div",{className:"mt-8 rounded-2xl border-border bg-card p-6 shadow-soft",children:[e.jsxs("div",{className:"flex justify-between text-xl font-semibold text-on-background",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["EGP ",N]})]}),e.jsx(m,{to:"/checkout",className:"mt-4 block",children:e.jsx(b,{variant:"primary",size:"lg",className:"w-full",children:"Proceed to checkout"})})]})]})}export{_ as Cart};
