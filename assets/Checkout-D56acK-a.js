import{u as D,o as E,r as u,x as O,c as k,j as r,m as i,B as b,A as F,C as $,D as z,z as x,t as B}from"./index-DkCHNvkI.js";import{S as f}from"./Skeleton-JuRaWzoZ.js";import{g as G,s as I}from"./orders-DwCKsmjF.js";const q={details:"",phone:"",city:""};function V(){const m=D(),j=E(),[o,y]=u.useState(q),[N,w]=u.useState("cash"),[c,l]=u.useState({}),{data:P}=O(),n=P?.data?.products??[],p=n.reduce((e,s)=>{const a=s.product?.priceAfterDiscount??s.price;return e+a*s.count},0),v=50,h=p+v,S=n.length===0,d=(e,s)=>{const a=s.trim();if(!a)return l(t=>({...t,[e]:`${e} is required`})),!1;if(e==="phone"){const t=a.replace(/\s+/g,"");if(!/^\d{10,}$/.test(t))return l(A=>({...A,phone:"Phone must be at least 10 digits (numbers only)"})),!1}return l(t=>({...t,[e]:""})),!0},g=k({mutationFn:()=>{const e={_id:G(),shippingAddress:o,cartItems:n.map(s=>({product:s.product?.id??s.product?._id??"",count:s.count,price:s.product?.priceAfterDiscount??s.price})),totalOrderPrice:h,createdAt:new Date().toISOString(),isPaid:!1,isDelivered:!1};return I(e),B.clear()},onSuccess:()=>{j.invalidateQueries({queryKey:["cart"]}),x.success("Order placed successfully!"),m("/orders")},onError:()=>x.error("Failed to complete order")}),C=e=>{e.preventDefault();let s=!0;for(const a of["details","city","phone"])d(a,o[a])||(s=!1);if(!s){x.error("Please fix the errors above");return}return g.mutate(),r.jsxs("div",{className:"mx-auto max-w-2xl px-4 py-8",children:[r.jsx(f,{className:"h-10 w-48 mb-8"}),r.jsx(f,{className:"h-64 rounded-[var(--radius-2xl)]"})]})};return S?r.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mx-auto max-w-2xl px-4 py-16 text-center",children:[r.jsx("h1",{className:"text-2xl font-bold text-[var(--color-foreground)] mb-4",children:"Your cart is empty"}),r.jsx(b,{variant:"primary",onClick:()=>m("/products"),children:"Browse products"})]}):r.jsxs(i.div,{initial:{opacity:0},animate:{opacity:1},className:"mx-auto max-w-2xl px-4 py-8 sm:px-6 lg:px-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-[var(--color-foreground)] mb-8",children:"Checkout"}),r.jsxs("form",{onSubmit:C,className:"space-y-6",children:[r.jsxs("div",{className:"rounded-[var(--radius-2xl)] border border-[var(--color-border)] bg-[var(--color-card)] p-6 shadow-[var(--shadow-soft)] space-y-4",children:[r.jsx("h2",{className:"font-semibold text-[var(--color-foreground)]",children:"Shipping address"}),["details","city","phone"].map(e=>r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-[var(--color-muted-foreground)] mb-1 capitalize",children:e==="details"?"Address":e}),r.jsx("input",{type:e==="phone"?"tel":"text",value:o[e],onChange:s=>{y(a=>({...a,[e]:s.target.value})),d(e,s.target.value)},onBlur:s=>d(e,s.target.value),className:`w-full h-11 px-4 rounded-[var(--radius-xl)]
                           border transition
                           bg-[var(--color-card)]
                           text-[var(--color-foreground)]
                           focus:ring-2 focus:outline-none
                           ${c[e]?"border-error focus:ring-error/20":"border-[var(--color-border)] focus:ring-[var(--color-primary)] focus:border-transparent"}`,placeholder:e==="phone"?"01234567890":e==="details"?"Street, building, apartment":"Cairo"}),c[e]&&r.jsx("p",{className:"text-xs text-error mt-1",children:c[e]})]},e))]}),r.jsxs("div",{className:"rounded-[var(--radius-2xl)] border border-[var(--color-border)] bg-[var(--color-card)] p-6 shadow-[var(--shadow-soft)] space-y-4",children:[r.jsx("h2",{className:"font-semibold text-[var(--color-foreground)]",children:"Payment method"}),r.jsx("div",{className:"grid sm:grid-cols-2 gap-4",children:[{id:"cash",label:"Cash on delivery",icon:F},{id:"visa",label:"Visa / Card payment",icon:$}].map(e=>{const s=e.icon,a=N===e.id;return r.jsxs(i.button,{type:"button",whileTap:{scale:.97},onClick:()=>w(e.id),className:`
            relative flex items-center gap-4 p-4 rounded-2xl border text-left
            transition-all duration-200
            ${a?"border-[var(--color-primary)] ring-2 ring-[var(--color-primary)]/30 bg-[var(--color-card-hover)]":"border-[var(--color-border)] hover:bg-[var(--color-card-hover)]"}
          `,children:[r.jsx("div",{className:`
              h-11 w-11 rounded-xl flex items-center justify-center
              ${a?"bg-[var(--color-primary)] text-white":"bg-[var(--color-card-hover)] text-[var(--color-muted-foreground)]"}
            `,children:r.jsx(s,{className:"h-5 w-5"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"font-medium text-[var(--color-foreground)]",children:e.label}),r.jsx("p",{className:"text-xs text-[var(--color-muted-foreground)]",children:e.id==="visa"?"Secure online payment":"Pay when the order arrives"})]}),r.jsx(z,{children:a&&r.jsx(i.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},className:"absolute top-2 right-2 h-3 w-3 rounded-full bg-[var(--color-primary)]"})})]},e.id)})})]}),r.jsxs("div",{className:"rounded-[var(--radius-2xl)] border border-[var(--color-border)] bg-[var(--color-card)] p-6 shadow-[var(--shadow-soft)] space-y-4",children:[r.jsx("div",{className:"space-y-3 text-sm",children:n.map(e=>{const s=e.product?.priceAfterDiscount??e.price;return r.jsxs("div",{className:"flex items-center justify-between text-[var(--color-muted-foreground)]",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("img",{src:e.product?.imageCover||e.product?.images?.[0],alt:e.product?.title,className:"h-10 w-10 rounded-lg object-cover"}),r.jsxs("span",{children:[e.product?.title," Ã— ",e.count]})]}),r.jsxs("span",{className:"text-[var(--color-foreground)] font-medium",children:["EGP ",s*e.count]})]},e._id)})}),r.jsx("div",{className:"h-px bg-[var(--color-border)]"}),r.jsxs("div",{className:"space-y-2 text-sm",children:[r.jsxs("div",{className:"flex justify-between text-[var(--color-muted-foreground)]",children:[r.jsx("span",{children:"Subtotal"}),r.jsxs("span",{className:"text-[var(--color-foreground)] font-medium",children:["EGP ",p]})]}),r.jsxs("div",{className:"flex justify-between text-[var(--color-muted-foreground)]",children:[r.jsx("span",{children:"Shipping fee"}),r.jsxs("span",{className:"text-[var(--color-foreground)] font-medium",children:["EGP ",v]})]})]}),r.jsx("div",{className:"h-px bg-[var(--color-border)]"}),r.jsxs("div",{className:"flex justify-between text-lg font-semibold text-[var(--color-foreground)]",children:[r.jsx("span",{children:"Total"}),r.jsxs("span",{children:["EGP ",h]})]}),r.jsx(b,{type:"submit",variant:"primary",size:"lg",className:"w-full",loading:g.isPending,disabled:Object.values(c).some(e=>e)||Object.values(o).some(e=>!e.trim()),children:"Place order"})]})]})]})}export{V as Checkout};
