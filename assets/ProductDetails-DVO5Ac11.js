import{n as E,r as N,o as Q,e as z,c as k,j as r,L as B,m as R,p,B as K,q as L,s as M,z as c,t as h,w as C}from"./index-BwQBjtFe.js";import{u as W,p as G}from"./useWishlistIds-Qz4AslgS.js";import{S as i}from"./Skeleton-COt5SVUs.js";function J(){const{id:s}=E(),[v,g]=N.useState(1),[b,I]=N.useState(0),l=Q(),A=W(),o=s?A.includes(s):!1,{data:f,isLoading:P,error:S}=z({queryKey:["product",s],queryFn:()=>G.getById(s).then(t=>t.data.data),enabled:!!s}),j=k({mutationFn:async t=>{const a=d=>{const n=d?.product,u=n?.id;if(typeof u=="string"&&u)return u;const x=n?._id;return typeof x=="string"&&x?x:""},w=l.getQueryData(["cart"]);if(w?.data?.products){const d=w.data.products.find(n=>a(n)===s);if(d)return h.updateCount(s,d.count+t)}const D=await h.add(s,t);return t>1?h.updateCount(s,t):D},onSuccess:()=>{l.invalidateQueries({queryKey:["cart"]}),c.success("Added to cart")},onError:()=>c.error("Failed to add to cart")}),y=k({mutationFn:()=>o?C.remove(s):C.add(s),onSuccess:()=>{l.invalidateQueries({queryKey:["wishlist"]}),c.success(o?"Removed from wishlist":"Added to wishlist")},onError:()=>c.error("Something went wrong")});if(S||!s)return r.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-16 text-center",children:[r.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Product not found."}),r.jsx(B,{to:"/products",className:"mt-4 inline-block text-indigo-600 dark:text-indigo-400 hover:underline",children:"Back to products"})]});if(P||!f)return r.jsx("div",{className:"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"grid gap-8 lg:grid-cols-2",children:[r.jsx(i,{className:"aspect-square rounded-3xl"}),r.jsxs("div",{className:"space-y-4",children:[r.jsx(i,{className:"h-10 w-3/4"}),r.jsx(i,{className:"h-6 w-1/2"}),r.jsx(i,{className:"h-32 w-full"})]})]})});const e=f,m=e.images?.length?e.images:[e.imageCover],q=e.priceAfterDiscount??e.price,F=e.priceAfterDiscount!=null;return r.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},className:"mx-auto max-w-7xl px-4 py-6 sm:py-8 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"grid gap-6 sm:gap-8 lg:grid-cols-2",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"aspect-square overflow-hidden rounded-3xl border border-[var(--color-border)] dark:border-[var(--color-border)] bg-[var(--color-card)] dark:bg-[var(--color-card)]",children:r.jsx("img",{src:m[b]??e.imageCover,alt:e.title,decoding:"async",className:"h-full w-full object-cover"})}),m.length>1&&r.jsx("div",{className:"-mx-4 flex gap-2 overflow-x-auto px-4 pb-2 touch-pan-x snap-x snap-mandatory sm:mx-0 sm:px-0",children:m.map((t,a)=>r.jsx("button",{type:"button",onClick:()=>I(a),className:p("h-20 w-20 shrink-0 snap-start rounded-xl border-2 overflow-hidden transition-all",b===a?"border-[var(--color-primary)] ring-2 ring-[var(--color-primary)]/30":"border-[var(--color-border)] dark:border-[var(--color-border)] hover:border-[var(--color-muted)] dark:hover:border-[var(--color-muted-foreground)]"),children:r.jsx("img",{src:t,alt:"",loading:"lazy",decoding:"async",className:"h-full w-full object-cover"})},a))})]}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl sm:text-3xl font-bold leading-tight text-[var(--color-foreground)]",children:e.title}),r.jsxs("p",{className:"mt-2 text-[var(--color-muted)] dark:text-[var(--color-muted-foreground)]",children:[e.category?.name," · ",e.brand?.name]}),r.jsxs("div",{className:"mt-6 flex flex-wrap items-end gap-3",children:[r.jsxs("span",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-primary)] dark:text-[var(--color-primary)]",children:["EGP ",q]}),F&&r.jsxs("span",{className:"text-base sm:text-xl text-[var(--color-muted)] line-through",children:["EGP ",e.price]})]}),r.jsx("p",{className:"mt-6 text-[var(--color-muted)] dark:text-[var(--color-muted-foreground)] leading-relaxed",children:e.description}),r.jsxs("div",{className:"mt-8 flex flex-col gap-4 sm:flex-row sm:flex-wrap sm:items-center sm:gap-4",children:[r.jsxs("div",{className:"order-1 sm:order-none flex items-center rounded-2xl border border-[var(--color-border)] dark:border-[var(--color-border)] overflow-hidden",children:[r.jsx("button",{type:"button",onClick:()=>g(t=>Math.max(1,t-1)),className:"h-12 w-12 flex items-center justify-center hover:bg-[var(--color-card-hover)] dark:hover:bg-[var(--color-card-hover)] transition-colors",children:"−"}),r.jsx("span",{className:"h-12 w-14 flex items-center justify-center font-medium border-x border-[var(--color-border)] dark:border-[var(--color-border)]",children:v}),r.jsx("button",{type:"button",onClick:()=>g(t=>Math.min(e.quantity,t+1)),className:"h-12 w-12 flex items-center justify-center hover:bg-[var(--color-card-hover)] dark:hover:bg-[var(--color-card-hover)] transition-colors",children:"+"})]}),r.jsxs(K,{variant:"primary",size:"lg",loading:j.isPending,onClick:()=>j.mutate(v),className:"order-3 sm:order-none sm:w-auto inline-flex items-center justify-center gap-2",children:[r.jsx(L,{className:"h-5 w-5"}),"Add to cart"]}),r.jsx("button",{type:"button",onClick:()=>y.mutate(),disabled:y.isPending,className:p("order-2 sm:order-none self-end sm:self-auto p-3 rounded-2xl border border-[var(--color-border)] dark:border-[var(--color-border)] hover:bg-[var(--color-card-hover)] dark:hover:bg-[var(--color-card-hover)] transition-colors",o&&"text-red-500 border-red-200 dark:border-red-900"),"aria-label":o?"Remove from wishlist":"Add to wishlist",children:r.jsx(M,{className:p("h-5 w-5",o&&"fill-current")})})]})]})]})})}export{J as ProductDetails};
